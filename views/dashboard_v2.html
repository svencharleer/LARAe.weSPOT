<html>
  <head>

     <title>LARAe.weSPOT</title>
     <%
      if(users[(userAuthProvider + "_" + userAuthId).toLowerCase()] == null)
        users[(userAuthProvider + "_" + userAuthId).toLowerCase()] = {name:"###",icon:""};


      //let's play with one inquiry atm
      //widgetsPerPhase:parsedData.widgetsPerPhase, ratings:parsedData.ratings, users: user.users, events: parsedData.event
      var widgetsPerPhase = data[defaultInquiry].data.widgetsPerPhase;


      %>
      <script type="application/javascript">
      var colors =           ["#33FF99","#33CCFF","#CCFF33","#FF0066","#CCFFFF","#FF66CC","#99CC66","#9999FF","#FFCC66", "#FF9966"];
      var colors_dark = ["#197F4C","#19667F","#667F19", "#7F0033","#667F7F","#7F3366" ];


      var dataPerInquiry = <%- JSON.stringify(data) %>;
      var activeInquiry = [];
          var userAuthProvider = "<%= userAuthProvider %>";
          var userAuthId = "<%= userAuthId %>";
          var users = <%- JSON.stringify(users) %>;
          var defaultInquiry = <%- defaultInquiry %>;
          var phases =[<%-availablePhases%>];
          var filters = <%- JSON.stringify(skillAndActivities) %>;


      </script>
     <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
     <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

      <link type="text/css" rel="stylesheet" href="/wespot/static/javascripts/3rdParty/jquery-dropdown/jquery.dropdown.css" />
      <script type="text/javascript" src="/wespot/static/javascripts/3rdParty/jquery-dropdown/jquery.dropdown.js"></script>
      <script type="text/javascript" src="/wespot/static/javascripts/3rdParty/crossfilter.js"></script>
      <script type="text/javascript" src="/wespot/static/javascripts/dashboard_logic.js"></script>
      <script type="text/javascript" src="/wespot/static/javascripts/tracking.js"></script>

      <link rel="stylesheet" href="/wespot/static/stylesheets/style.css">
</head>
<body  id="mainBody">
<div id="titleField">
    <% if(iframe == undefined) {%>
    <img id="wespot_logo" src="/wespot/static/images/wespot_logo.png"/>
    <%}%>




    <div id="subsections">
        <select style="min-width: 200px" multiple id="inquirySelection" size="3" onchange="javascript:inquirySelectionChanged()">
            <% Object.keys(data).forEach(function(inq){ %>
            <option value="<%=inq%>"><%=data[inq].inquiry.title%></option>
            <% });%>
        </select>
        <select style="min-width: 200px" multiple id="studentSelection" size="3" onchange="javascript:studentSelectionChanged()">

        </select>
        <% if(skillAndActivities != undefined && skillAndActivities != {} && Object.keys(skillAndActivities).length != 0){%>
        <select style="min-width: 200px" multiple id="skillSelection" size="3" onchange="javascript:skillSelectionChanged()">
            <% Object.keys(skillAndActivities).forEach(function(skill){ %>
            <option value="<%=skill%>" selected="true"><%=skillAndActivities[skill].skill%></option>
            <% });%>
        </select>
        <% }%>
        <input type="checkbox" id="adminRating" onchange="javascript:adminRatingChanged()"/><span style="color:black">Show only admin ratings</span>
    </div>
    <table id="legend">
        <tbody><tr>
        <tr>
            <td colspan="6">
                Star rating none - 5
            </td>
        </tr>
        <td><svg style="vertical-align: bottom" width="20" height="20">
            <circle cx="10" cy="10" r="10" fill="#565656"></circle>
            <path class="eventSquare widget_ARLearn" d="M0,-8A8,8 0 0,1 0.6972459419812653,-7.969557584733964L0.17431148549531633,-1.992389396183491A2,2 0 0,0 0,-2Z" stroke="#595959" transform="translate(10,10)" fill="#33FF99" stroke-width="0px"></path>
        </svg></td>
        <td><svg style="vertical-align: bottom" width="20" height="20">
            <circle cx="10" cy="10" r="10" fill="#565656"></circle>
            <path class="eventSquare widget_hypothesis" d="M0,-8A8,8 0 0,1 7.608452130361228,-2.472135954999579L1.902113032590307,-0.6180339887498948A2,2 0 0,0 0,-2Z" stroke="#595959" transform="translate(10,10)" fill="#33FF99" stroke-width="0px"></path>
        </svg></td>
        <td><svg style="vertical-align: bottom" width="20" height="20">
            <circle cx="10" cy="10" r="10" fill="#565656"></circle>
            <path class="eventSquare widget_ARLearn" d="M0,-8A8,8 0 0,1 4.702282018339785,6.472135954999579L1.1755705045849463,1.6180339887498947A2,2 0 0,0 0,-2Z" stroke="#595959" transform="translate(10,10)" fill="#33FF99" stroke-width="0px"></path>
        </svg></td>
        <td><svg style="vertical-align: bottom" width="20" height="20">
            <circle cx="10" cy="10" r="10" fill="#565656"></circle>
            <path class="eventSquare widget_page" d="M0,-8A8,8 0 1,1 -4.702282018339784,6.472135954999579L-1.175570504584946,1.6180339887498947A2,2 0 1,0 0,-2Z" stroke="#595959" transform="translate(10,10)" fill="#33FF99" stroke-width="0px"></path>
        </svg></td>
        <td><svg style="vertical-align: bottom" width="20" height="20">
            <circle cx="10" cy="10" r="10" fill="#565656"></circle>
            <path class="eventSquare widget_hypothesis" d="M0,-8A8,8 0 1,1 -7.608452130361228,-2.4721359549995783L-1.902113032590307,-0.6180339887498946A2,2 0 1,0 0,-2Z" stroke="#595959" transform="translate(10,10)" fill="#33FF99" stroke-width="0px"></path>
        </svg></td>
        <td><svg style="vertical-align: bottom" width="20" height="20">
            <circle cx="10" cy="10" r="10" fill="#565656"></circle>
            <path class="eventSquare widget_hypothesis" d="M0,8A8,8 0 1,1 0,-8A8,8 0 1,1 0,8M0,2A2,2 0 1,0 0,-2A2,2 0 1,0 0,2Z" stroke="#595959" transform="translate(10,10)" fill="#33FF99" stroke-width="0px"></path>
        </svg></td>

        </tr>
        </tbody></table>
</div>
<table id="phases">
    <tr id="phases_headers" >

        <th class="title_student"><span onclick="javascript:sortBy('name');">Name</span></th>
        <% if(availablePhases.indexOf(1) >= 0) { %> <th class="title_phase1"><span onclick="javascript:sortBy('1');">Question / Hypothesis</span><a href="#" data-dropdown="#dropdown-phase1"></a></th> <% } %>
        <% if(availablePhases.indexOf(2) >= 0) { %><th class="title_phase1"><span onclick="javascript:sortBy('2');">Operationalisation</span><a href="#" data-dropdown="#dropdown-phase2"></a></th><% } %>
        <% if(availablePhases.indexOf(3) >= 0) { %><th class="title_phase1"><span onclick="javascript:sortBy('3');">Data Collection</span><a href="#" data-dropdown="#dropdown-phase3"></a></th><% } %>
        <% if(availablePhases.indexOf(4) >= 0) { %><th class="title_phase1" ><span onclick="javascript:sortBy('4');">Data Analysis</span><a href="#" data-dropdown="#dropdown-phase4"></a></th><% } %>
        <% if(availablePhases.indexOf(5) >= 0) { %><th class="title_phase1"><span onclick="javascript:sortBy('5');">Interpretation</span><a href="#" data-dropdown="#dropdown-phase5"></a></th><% } %>
        <% if(availablePhases.indexOf(6) >= 0) { %><th class="title_phase1"><span onclick="javascript:sortBy('6');">Communication</span><a href="#" data-dropdown="#dropdown-phase6"></a></th><% } %>
        <th class="title_data">Data</th>

    </tr>
</table>



<div id="userList" class="scrollableView">
<table id="mainTable">
    <script type="application/javascript">
        regenerate();
        </script>

</table>
</div>

<div id="eventData" class="scrollableView">

</div>



<%
    var phases = availablePhases;
    phases.forEach(function(p)
    {
%>

    <div id="dropdown-phase<%= p %>" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
            <li><a id="dropdown-phase<%= p %>_" href="#" class="dd_selected" onClick="javascript:filter(<%= p %>,'')">all</a></li>
<%
        if(widgetsPerPhase[p] != undefined)
        {
            widgetsPerPhase[p].forEach(function(d){ %>
            <li><a id="dropdown-phase<%= p %>_<%= d %>" href="#" onClick="javascript:filter(<%= p %>, '<%= d %>')"><%= d %></a></li>
<%          });
        }
%>
        </ul>
    </div>
<%
    });
%>

</body>

  <script type="application/javascript">

      function correctSizes()
      {


              var phases = $("#phases_headers").children();
              phases.each(function (c) {
                  if (!$(this).hasClass("title_data")) {
                      $(this).css("width", (2 * ($("#mainBody").width() / 3)) / 7);
                  }
              })




              $("#userList").css("width", parseInt((2 * ($("#mainBody").width() / 3))));
              $("#eventData").css("width", (($("#mainBody").width() / 3)) - 20);
              $("#eventData").css("margin-left", (2 * ($("#mainBody").width() / 3)));
              $("#userList").css("height", ($("#mainBody").height()) - $("#userList").position().top);
              $("#eventData").css("height", $("#userList").css("height"));

          $(".studentName").attr("width", parseInt((2 * ($("#mainBody").width() / 3)) / 7));
          $(".visualization").attr("width", parseInt((2 * ($("#mainBody").width() / 3)) / 7));
          console.log("resize");

      }
      $(document).ready(correctSizes);
      $(window).resize(correctSizes);

      //select default inq
      $("#inquirySelection").val(defaultInquiry);
      inquirySelectionChanged();

  </script>

</html>